<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Ops on travis jeffery</title><link>https://travisjeffery.com/tags/ops/</link><description>Recent content in Ops on travis jeffery</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Thu, 07 Sep 2017 00:00:00 +0000</lastBuildDate><atom:link href="https://travisjeffery.com/tags/ops/index.xml" rel="self" type="application/rss+xml"/><item><title>Manage Datadog with Terraform</title><link>https://travisjeffery.com/posts/2017-09-07-datadog-terraform/</link><pubDate>Thu, 07 Sep 2017 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2017-09-07-datadog-terraform/</guid><description/></item><item><title>EC2’S magical address to get instance metadata</title><link>https://travisjeffery.com/posts/2016-11-29-magical-ec2-address/</link><pubDate>Tue, 29 Nov 2016 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2016-11-29-magical-ec2-address/</guid><description>&lt;p&gt;There’s a magical address in EC2 that you can query to get metadata on that instance (&lt;code&gt;http://169.254.169.254&lt;/code&gt;). What’s especially awesome about it, is that you can use it inside Docker containers which makes it an easy
way to find the host IP from inside the container without having to pass it in via an env var or equivalent.&lt;/p&gt;
&lt;p&gt;Behold! I’m curling inside a Docker container and from the host and
getting the host’s IP address both times:&lt;/p&gt;</description></item><item><title>Monitoring with InfluxData's TICK stack</title><link>https://travisjeffery.com/posts/2016-09-23-influxdb-monitoring/</link><pubDate>Fri, 23 Sep 2016 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2016-09-23-influxdb-monitoring/</guid><description/></item><item><title>Techniques to Achieve High Write Throughput With Elasticsearch</title><link>https://travisjeffery.com/posts/2016-06-08-elasticsearch-write-throughput/</link><pubDate>Wed, 08 Jun 2016 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2016-06-08-elasticsearch-write-throughput/</guid><description/></item><item><title>SSH into EC2 instance with instance ID</title><link>https://travisjeffery.com/posts/2015-11-30-ssh-into-ec2-instance-with-instance-id/</link><pubDate>Mon, 30 Nov 2015 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2015-11-30-ssh-into-ec2-instance-with-instance-id/</guid><description>&lt;p&gt;Make sure you&amp;rsquo;ve installed and configured the &lt;a href="https://github.com/aws/aws-cli"&gt;aws-cli&lt;/a&gt; and &lt;a href="https://github.com/stedolan/jq"&gt;jq&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Drop this function into your .zshrc or .bashrc:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-sh" data-lang="sh"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#cf222e"&gt;function&lt;/span&gt; ec2-ssh &lt;span style="color:#0550ae"&gt;()&lt;/span&gt; &lt;span style="color:#0550ae"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ssh &lt;span style="color:#cf222e"&gt;$(&lt;/span&gt;aws ec2 describe-instances --filter &lt;span style="color:#953800"&gt;Name&lt;/span&gt;&lt;span style="color:#0550ae"&gt;=&lt;/span&gt;instance-id,Values&lt;span style="color:#0550ae"&gt;=&lt;/span&gt;&lt;span style="color:#953800"&gt;$1&lt;/span&gt; &lt;span style="color:#1f2328"&gt;|&lt;/span&gt; jq &lt;span style="color:#0a3069"&gt;&amp;#39;.Reservations[0].Instances[0].PrivateIpAddress&amp;#39;&lt;/span&gt; &lt;span style="color:#1f2328"&gt;|&lt;/span&gt; tr -d &lt;span style="color:#0a3069"&gt;&amp;#39;&amp;#34;&amp;#39;&lt;/span&gt;&lt;span style="color:#cf222e"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#0550ae"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And now you can ssh into your EC2 instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-sh" data-lang="sh"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$ ec2-ssh i-6g5c7ed4
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Outbound connections from Docker with VirtualBox not working?</title><link>https://travisjeffery.com/posts/2015-11-17-outbound-connections-from-docker-with-virtualbox-not-working/</link><pubDate>Tue, 17 Nov 2015 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2015-11-17-outbound-connections-from-docker-with-virtualbox-not-working/</guid><description>&lt;p&gt;Using Docker and VirtualBox and having trouble making outbound
connections? You may have errors similar to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;curl: (7) Failed connect to 10.0.2.224:8000; No route to host&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Error: Redis connection to redis:6379 failed - connect EHOSTUNREACH&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here&amp;rsquo;s what I did to fix it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;I ssh&amp;rsquo;d into the Docker machine:&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$ docker-machine ssh dev
```&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Checked eth0&amp;rsquo;s subnet:
&lt;pre tabindex="0"&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$ ifconfig eth0
eth0 Link encap:Ethernet HWaddr 08:00:27:C8:C7:50
inet addr:10.254.0.15 Bcast:10.254.0.255 Mask:255.255.255.0
inet6 addr: fe80::a00:27ff:fec8:c750/64 Scope:Link
UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1
RX packets:230796 errors:0 dropped:0 overruns:0 frame:0
TX packets:62400 errors:0 dropped:0 overruns:0 carrier:0
collisions:0 txqueuelen:1000
RX bytes:238029328 (227.0 MiB) TX bytes:4768029 (4.5 MiB)&lt;/p&gt;</description></item><item><title>Building infrastructure with Docker, AWS ECS, and Hashicorp's Terraform</title><link>https://travisjeffery.com/posts/2015-10-07-building-infrastructure-with-docker/</link><pubDate>Wed, 07 Oct 2015 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2015-10-07-building-infrastructure-with-docker/</guid><description>&lt;p&gt;&lt;a href="https://segment.com/blog/rebuilding-our-infrastructure/"&gt;Here&amp;rsquo;s a post on Segment&amp;rsquo;s blog&lt;/a&gt; on our new infrastructure setup I&amp;rsquo;ve been working on.&lt;/p&gt;</description></item><item><title>Piping into a Docker container</title><link>https://travisjeffery.com/posts/2015-10-25-piping-into-a-docker-container/</link><pubDate>Fri, 25 Sep 2015 00:00:00 +0000</pubDate><guid>https://travisjeffery.com/posts/2015-10-25-piping-into-a-docker-container/</guid><description>&lt;p&gt;Here&amp;rsquo;s how you can write docker images that you can pipe into:&lt;/p&gt;
&lt;p&gt;Dockerfile, here I&amp;rsquo;m installing the go programs I&amp;rsquo;m going to run and pipe into:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-sh" data-lang="sh"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;FROM golang
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;RUN go get github.com/segmentio/throttle
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;RUN go get github.com/segmentio/json_to_nsq
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;COPY entrypoint.sh /entrypoint.sh
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;CMD &lt;span style="color:#0550ae"&gt;[&lt;/span&gt;&lt;span style="color:#0a3069"&gt;&amp;#34;/bin/sh&amp;#34;&lt;/span&gt;, &lt;span style="color:#0a3069"&gt;&amp;#34;/entrypoint.sh&amp;#34;&lt;/span&gt;&lt;span style="color:#0550ae"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;entrypoint.sh, here I&amp;rsquo;m reading from stdin and piping into the programs I want to run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-sh" data-lang="sh"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#953800"&gt;rate&lt;/span&gt;&lt;span style="color:#0550ae"&gt;=&lt;/span&gt;&lt;span style="color:#0a3069"&gt;${&lt;/span&gt;&lt;span style="color:#953800"&gt;2&lt;/span&gt;&lt;span style="color:#cf222e"&gt;:-&lt;/span&gt;&lt;span style="color:#953800"&gt;50&lt;/span&gt;&lt;span style="color:#0a3069"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#953800"&gt;addr&lt;/span&gt;&lt;span style="color:#0550ae"&gt;=&lt;/span&gt;&lt;span style="color:#0a3069"&gt;${&lt;/span&gt;&lt;span style="color:#953800"&gt;3&lt;/span&gt;&lt;span style="color:#cf222e"&gt;:-&lt;/span&gt;&lt;span style="color:#953800"&gt;nsqd&lt;/span&gt;&lt;span style="color:#1f2328"&gt;:&lt;/span&gt;&lt;span style="color:#953800"&gt;4150&lt;/span&gt;&lt;span style="color:#0a3069"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#6639ba"&gt;echo&lt;/span&gt; &lt;span style="color:#0a3069"&gt;&amp;#34;Sending events to &lt;/span&gt;&lt;span style="color:#953800"&gt;$addr&lt;/span&gt;&lt;span style="color:#0a3069"&gt; at the rate of &lt;/span&gt;&lt;span style="color:#953800"&gt;$rate&lt;/span&gt;&lt;span style="color:#0a3069"&gt;/s&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;cat - &lt;span style="color:#0a3069"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#0a3069"&gt;&lt;/span&gt; &lt;span style="color:#1f2328"&gt;|&lt;/span&gt; throttle &lt;span style="color:#953800"&gt;$rate&lt;/span&gt; &lt;span style="color:#0a3069"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#0a3069"&gt;&lt;/span&gt; &lt;span style="color:#1f2328"&gt;|&lt;/span&gt; json_to_nsq -t events -a &lt;span style="color:#0a3069"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#953800"&gt;$addr&lt;/span&gt;&lt;span style="color:#0a3069"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And here&amp;rsquo;s how to run it (assuming the image is called &lt;code&gt;events&lt;/code&gt;):&lt;/p&gt;</description></item></channel></rss>