<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Travis Jeffery">
    <link href="/css/style.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,400i|IBM+Plex+Serif:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css" type="text/css" media="screen">
    <script src="/js/jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="/js/judy.js" type="text/javascript" charset="utf-8"></script>
    <script src="/js/main.js" type="text/javascript" charset="utf-8"></script>
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
     ga('create', 'UA-8462120-1', 'travisjeffery.com');
      ga('send', 'pageview');
    </script>
    <title>Modern grep</title>
  </head>
  <body>
    <div class="container-fluid container">
      <div class="row">
        <div class="col-xs-12 col-lg-8 col-lg-offset-2">
          <hgroup id="header">
            <h1 class="logo col-xs-6">
              <a class="" href="/">travis jeffery</a>
            </h1>
          
            <div class="social col-xs-6 pull-xs-right">
                  <a href="https://twitter.com/travisjeffery" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @travisjeffery</a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
            </div>
          </hgroup>

          <hr>

          <article>
            <header>
              <h1 class="article-title three-quarter-margin-bottom">Modern grep</h1>
            </header>

            <p>While grep reigned as the preeminent text search tool for a long time, its overly unopinionated
approach to defaults and maintaining backwards compatibility has allowed new tools — like ack, the
silver searcher, and ripgrep — to gain users and encroach on grep’s territory. For example, git
stores unreadable blobs under the .git directory in your repos and it doesn’t make sense to search
these files. However, grep doesn’t ignore this files by default unlike ack and ripgrep.</p>
<p>On average, a search by a newbie ack user will be faster than the same search by a newbie grep user,
despite the fact that grep is written in C and ack in Perl, because ack conveniently ignores folders
and files you probably don’t want searched — like .git or the files listed in your .gitignore.</p>
<blockquote>
<p>I feel the need…the need for speed!</p>
</blockquote>
<p>With some grep know-how, we can make grep faster and behave like these modern search tools.</p>
<h2 id="exclude-directories">Exclude Directories</h2>
<p>grep can exclude directories that it searches, increasing its speed substantially. The following excludes the .git directory from its search:</p>
<pre><code class="hljs">$ <span class="hljs-keyword">grep</span> --<span class="hljs-keyword">exclude</span>-dir=.git</code></pre>

<p>This speeds up searches by a lot, I ran two uncached searches in Rails’s repo:</p>
<pre><code class="hljs">$ grep -r <span class="hljs-string">"class &lt;&lt; self"</span> .

$ grep -rIPs <span class="hljs-attribute">--exclude-dir</span>=.[a-zA-Z0-9]* <span class="hljs-attribute">--exclude</span>=.* <span class="hljs-attribute">--exclude</span>=*~ <span class="hljs-string">"class &lt;&lt; self"</span> .</code></pre>

<p>He former, non-excluding, grep took 6.009s. The
latter, excluding, grep took 2.235s.</p>
<h2 id="perl-regular-expressions">Perl Regular Expressions</h2>
<p>Modern search tools like ack support the popular Perl regular expressions. By default, grep uses
the less known POSIX regular expressions.</p>
<p>For example, let’s say we want to match a phone number and capture its area
codes.</p>
<p>The Perl regular expression:</p>
<pre><code class="hljs">(<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{3}</span></span>)-<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{3}</span></span>-<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{4}</span></span></code></pre>

<p>The POSIX regular expression:</p>
<pre><code class="hljs">\([<span class="hljs-number">0</span><span class="hljs-number">-9</span>]\{<span class="hljs-number">3</span>\}\)-[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]\{<span class="hljs-number">3</span>\}-[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]\{<span class="hljs-number">4</span>\}</code></pre>

<p>Fortunately, you can use Perl regular expressions with grep by giving it the
<code>-P</code> or <code>--perl-regexp</code> argument.</p>
<pre><code class="hljs">grep -P "(<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{3}</span></span>)-<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{3}</span></span>-<span class="hljs-tag">\<span class="hljs-name">d</span><span class="hljs-string">{4}</span></span>"</code></pre>

<h2 id="useful-defaults">Useful Defaults</h2>
<p>Having to give grep all these arguments would be a drag, to configure grep to exclude hidden directories and use Perl regular expressions by default, set the shell variable <code>GREP_OPTIONS</code>:</p>
<p><code>export GREP_OPTIONS=&#39;-rIPs --exclude-dir=.[a-zA-Z0-9]* --exclude=.* --exclude=*~ --color=auto&#39;</code></p>
<p>There’s no argument to make grep organize its output like ack. Also, neither
integrates with git, but git has its own grep for searching your repos. You can read my post on <a href="/b/2012/02/search-a-git-repo-like-a-ninja/">searching git like a ninja</a> to learn about <code>git grep</code> and get the best of both grep and ack.</p>
<h2 id="sources-and-further-reading">Sources and further reading</h2>
<ul>
<li><a href="http://lists.freebsd.org/pipermail/freebsd-current/2010-August/019310.html">why GNU grep is fast</a></li>
<li><a href="http://en.wikipedia.org/wiki/Grep#History">History of grep</a> (including Ken Thompson’s inspiration for the name: ed’s <code>g/re/p</code> — similar to the <code>:g/re/p</code> Vim user’s have today!)</li>
<li>you will need grep version &gt;= 2.5.3 to use <code>--exclude-dir</code></li>
</ul>


          </article>

          <hr>

          <footer>
            <p class="half-margin-bottom">
              Share: <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="travisjeffery" data-size="large">Tweet about this article</a><br>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
              Written: February 9th, 2012<br>
              Tags: tools
            </p>

            <p class="one-margin-bottom"><a href="/#recent">Read more posts &#8230;</a></p>
          </footer>
          <hr>
          
          <footer class="footer">
            <a href="https://twitter.com/travisjeffery" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @travisjeffery</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>  
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
